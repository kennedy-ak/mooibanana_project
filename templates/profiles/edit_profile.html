
<!-- templates/profiles/edit_profile.html -->
{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Edit Profile - Mooibanana{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header text-center">
                <h3>Edit Profile</h3>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form|crispy }}

                    <!-- Location Helper -->
                    <div class="mb-3">
                        <label class="form-label">Location Helper</label>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-primary" onclick="getCurrentLocation()">
                                <i class="fas fa-map-marker-alt"></i> Use Current Location
                            </button>
                            <small class="text-muted align-self-center">
                                This helps other users find you based on distance
                            </small>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <a href="{% url 'profiles:my_profile' %}" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function getCurrentLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                // Set the latitude and longitude fields
                const latField = document.getElementById('id_latitude');
                const lonField = document.getElementById('id_longitude');

                if (latField && lonField) {
                    latField.value = position.coords.latitude.toFixed(6);
                    lonField.value = position.coords.longitude.toFixed(6);

                    // Show success message
                    alert('Location successfully set! Latitude: ' + position.coords.latitude.toFixed(6) + ', Longitude: ' + position.coords.longitude.toFixed(6));
                }
            },
            function(error) {
                let errorMessage = 'Could not get location: ';
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage += 'Location access denied by user.';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage += 'Location information unavailable.';
                        break;
                    case error.TIMEOUT:
                        errorMessage += 'Location request timeout.';
                        break;
                    default:
                        errorMessage += 'Unknown error.';
                        break;
                }
                alert(errorMessage);
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            }
        );
    } else {
        alert('Geolocation is not supported by this browser.');
    }
}
</script>
{% endblock %}